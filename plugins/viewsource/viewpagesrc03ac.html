                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=21299899 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 10:35:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage03ac.html?pageId=21299899" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Version compatibility" style="background-image: url(../servlet/confluence/placeholder/macro-heading77d5.png?definition=e25vdGU6dGl0bGU9VmVyc2lvbiBjb21wYXRpYmlsaXR5fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Language switcher in Symfony stack is compatible with <strong>eZ Publish 5.3 / 2014.05</strong></p></td></tr></table><p><span><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"><br /></span></p><h2><span>Description</span></h2><p><span>A content can be translated in several languages. Those languages are configured in the system and exposed in SiteAccesses via a prioritized list of languages:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ezpublish.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish
    system:
        eng:
            languages: [eng-GB]
        # In fre siteaccess, fre-FR is always preferred, and fallback to eng-GB if needed.
        fre:
            languages: [fre-FR, eng-GB]</pre></td></tr></table><p><span><span>When visiting a content, it may be useful to let the user switch from one translation to another, more appropriate to him. This is precisely the goal of the language switcher.</span></span></p><p><span><span><span>The language switcher relies on the </span><a class="confluence-link" href="../../display/EZP/Cross%2bSiteAccess%2blinks.html" data-linked-resource-id="21299772" data-linked-resource-type="page" data-linked-resource-default-alias="Cross SiteAccess links" data-base-url="../../index.html">Cross-SiteAccess linking feature</a><span> to generate links to the content's translation, and on </span><a class="confluence-link" href="../../display/EZP/RouteReference.html" data-linked-resource-id="21299904" data-linked-resource-type="page" data-linked-resource-default-alias="RouteReference" data-base-url="../../index.html">RouteReference feature</a><span>.</span></span></span></p><h2><span><span><span>Usage</span></span></span></h2><h3><span><span><span>Configuration: explicit <em>translation SiteAccesses</em></span></span></span></h3><p><span><span><span><span>Configuration is not mandatory, but can help to distinguish which SiteAccesses can be considered </span><em>translation SiteAccesses</em><span>.</span></span></span></span></p><p> </p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ezpublish.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    siteaccess:
        default_siteaccess: eng
        list:
            - ezdemo_site
            - eng
            - fre
            - ezdemo_site_admin

        groups:
            ezdemo_frontend_group:
                - ezdemo_site
                - eng
                - fre

    # ...

    system:
        # Specifying which SiteAccesses are used for translation
        ezdemo_frontend_group:
            translation_siteaccesses: [fre, eng]
        eng:
            languages: [eng-GB]
        fre:
            languages: [fre-FR, eng-GB]
        ezdemo_site:
            languages: [eng-GB]</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><strong>Note</strong>: Top prioritized language is always used for as the SiteAccess language reference (e.g. <code>fre-FR</code> for <code>fre</code> SiteAccess in the example above).</p><p>If several translation SiteAccesses share the same language reference, <strong>the first declared SiteAccess always wins</strong>.</p></td></tr></table><h3>Configuration: more complex translation setup</h3><p>There are some cases where your SiteAccesses share settings (repository, content settings...), but you don't want all of them to share the same <code>translation_siteaccesses</code> setting. This can be the case when you use SiteAccesses for mobile.</p><p>Solution is as easy as defining new groups:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ezpublish.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    siteaccess:
        default_siteaccess: eng
        list:
            - ezdemo_site
            - eng
            - fre
            - mobile_eng
            - mobile_fre
            - ezdemo_site_admin

        groups:
            # This group can be used for common front settings
            ezdemo_common_group:
                - ezdemo_site
                - eng
                - fre
                - mobile_eng
                - mobile_fre

            ezdemo_frontend_group:
                - ezdemo_site
                - eng
                - fre

            ezdemo_mobile_group
                - mobile_eng
                - mobile_fre

    # ...

    system:
        # Translation SiteAccesses for regular frontend
        ezdemo_frontend_group:
            translation_siteaccesses: [fre, eng]

        # Translation SiteAccesses for mobile frontend
        ezdemo_mobile_group:
            translation_siteaccesses: [mobile_fre, mobile_eng]

        eng:
            languages: [eng-GB]
        fre:
            languages: [fre-FR, eng-GB]
        ezdemo_site:
            languages: [eng-GB]

        mobile_eng:
            languages: [eng-GB]
        mobile_fre:
            languages: [fre-FR, eng-GB]</pre></td></tr></table><h3>Configuration: using implicit <em>related SiteAccesses</em></h3><p>If <code>translation_siteaccesses</code> setting is not provided, implicit <em>related SiteAccesses</em> will be used instead. SiteAccesses are considered <em>related</em> if they share:</p><ul><li>The same repository</li><li>The same root location Id (see <a class="confluence-link" href="../../display/EZP/Multisite%2busing%2bcontent_root.html" data-linked-resource-id="12781016" data-linked-resource-type="page" data-linked-resource-default-alias="Multisite using content_root" data-base-url="../../index.html">Multisite feature</a>)</li></ul><h3>In a template</h3><p><span>To generate a language switch link, you need to generate the </span><code>RouteReference</code><span>, with the </span><code>language</code><span> parameter. This can easily be done with </span><code>ez_route()</code><span> Twig function:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=xml" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Given that "location" variable is a valid Location object #}
&lt;a href="{{ url( ez_route( location, {"language": "fre-FR"} ) ) }}">{{ ez_content_name( content ) }}&lt;/a>

{# Generating a link to a declared route instead of Location #}
&lt;a href="{{ url( ez_route( 'my_route', {"language": "fre-FR"} ) ) }}">My link&lt;/a></pre></td></tr></table><p><span><span>You can also omit the route, in this case, the current route will be used (i.e. switch the current page):</span></span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=xml" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Using Twig named parameters #}
&lt;a href="{{ url( ez_route( params={"language": "fre-FR"} ) ) }}">My link&lt;/a>

{# Identical to the following, using ordered parameters #}
&lt;a href="{{ url( ez_route( null, {"language": "fre-FR"} ) ) }}">My link&lt;/a></pre></td></tr></table><h3>Using sub-requests</h3><p>When using sub-requests, you lose the context of the master request (e.g. current route, current location...). This is because sub-requests can be displayed separately, with ESI or Hinclude.</p><p>If you want to render language switch links in a sub-request with a correct <code>RouteReference</code>, you must pass it as an argument to your sub-controller from the master request.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=xml" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# Render the language switch links in a sub-controller #}
{{ render( controller( 'AcmeTestBundle:Default:languages', {'routeRef': ez_route()} ) ) }}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>namespace Acme\TestBundle\Controller;

use eZ\Bundle\EzPublishCoreBundle\Controller;
use eZ\Publish\Core\MVC\Symfony\Routing\RouteReference;

class DefaultController extends Controller
{
    public function languagesAction( RouteReference $routeRef )
    {
        return $this->render( 'AcmeTestBundle:Default:languages.html.twig', array( 'routeRef' => $routeRef ) );
    }
}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=xml" style="background-image: url(../servlet/confluence/placeholder/macro-headingf20b.png?definition=e2NvZGU6bGFuZ3VhZ2U9eG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{# languages.html.twig #}

{# Looping over all available languages to display the links #}
{% for lang in ezpublish.availableLanguages %}
    {# This time, we alter the "siteaccess" parameter directly. #}
    {# We get the right siteaccess with the help of ezpublish.translationSiteAccess() helper #}
    {% do routeRef.set( "siteaccess", ezpublish.translationSiteAccess( lang ) ) %}
    &lt;a href="{{ url( routeRef ) }}">{{ lang }}&lt;/a>&lt;br />
{% endfor %}</pre></td></tr></table><ul><li><code>ezpublish.translationSiteAccess( language )</code> returns the SiteAccess name for provided language (or <code>null</code> if it cannot be found)</li><li><code>ezpublish.availableLanguages()</code> returns the list of available languages.</li></ul><h3>Using PHP</h3><p><span>You can easily generate language switch links from PHP too, with the </span><code>RouteReferenceGenerator</code><span> service:</span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>// Assuming we're in a controller
/** @var \eZ\Publish\Core\MVC\Symfony\Routing\Generator\RouteReferenceGeneratorInterface $routeRefGenerator */
$routeRefGenerator = $this->get( 'ezpublish.route_reference.generator' );
$routeRef = $routeRefGenerator->generate( $location, array( 'language' => 'fre-FR' ) );
$link = $this->generateUrl( $routeRef );</pre></td></tr></table><p><span><span><br /></span></span></p><p><span><span>You can also retrieve all available languages with the </span><code>TranslationHelper</code><span>:</span></span></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>/** @var \eZ\Publish\Core\Helper\TranslationHelper $translationHelper */
$translationHelper = $this->get( 'ezpublish.translation_helper' );
$availableLanguages = $translationHelper->getAvailableLanguages();</pre></td></tr></table><p> </p><p> </p><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=21299899 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 10:35:57 GMT -->
</html>
