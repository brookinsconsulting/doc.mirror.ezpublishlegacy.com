                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=8323268 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 09:41:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpagecff3.html?pageId=8323268" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <p> </p><p>For better integration between 5.x (symfony based) kernel and legacy (4.x) kernel, injection is used to inject settings, <a class="confluence-link" href="../../display/EZP/Legacy%2bsession%2binjection.html" data-linked-resource-id="8323285" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy session injection" data-base-url="../../index.html">session</a> and <a class="confluence-link" href="../../display/EZP/Legacy%2bsiteaccess%2binjection.html" data-linked-resource-id="8323272" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy siteaccess injection" data-base-url="../../index.html">current siteaccess</a> from 5.x into legacy using an event: <span class="nv" style="color: rgb(0,128,128);"><a class="confluence-link" href="../../display/EZP/Legacy%2bkernel%2bevent.html" data-linked-resource-id="8323280" data-linked-resource-type="page" data-linked-resource-default-alias="Legacy kernel event" data-base-url="../../index.html">kernel.event_subscriber</a></span></p><p><span class="nv" style="color: rgb(0,128,128);"><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"><br /></span></p><h2>Injected settings</h2><p>Several settings are injected to avoid having to duplicate settings across new and old kernel, this is done in eZ\Bundle\EzPublishLegacyBundle\LegacyMapper\Configuration.<br />For mappings below, yml settings prefixed with ezpublish are system settings, while the rest are settings you can define per siteaccess.</p><table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=For versions 5.1, 5.2 and 5.3" style="background-image: url(../servlet/confluence/placeholder/macro-heading6960.png?definition=e25vdGU6dGl0bGU9Rm9yIHZlcnNpb25zIDUuMSwgNS4yIGFuZCA1LjN9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>When viewing <em>ini</em> settings in the Administration Interface, settings for other siteaccess may be incorrectly displayed if the configuration has been modified in Symfony configuration.</p></td></tr></table><p> </p><h3>Database settings</h3><p>The settings for &quot;Server&quot;, &quot;Port&quot;, &quot;User&quot;, &quot;Password&quot;, &quot;Database&quot; and &quot;DatabaseImplementation&quot; are set based on the current settings in your yml files, either from the explicit settings defined below, or the &quot;dsn&quot;</p><p><strong>Mapping</strong>:</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">yml</th><th class="confluenceTh">site.ini <span>[</span><span>DatabaseSettings]</span></th></tr><tr><td class="confluenceTd">server</td><td class="confluenceTd">Server</td></tr><tr><td class="confluenceTd">port</td><td class="confluenceTd">Port</td></tr><tr><td class="confluenceTd">user</td><td class="confluenceTd">User</td></tr><tr><td colspan="1" class="confluenceTd">password</td><td colspan="1" class="confluenceTd">Password</td></tr><tr><td colspan="1" class="confluenceTd">database_name</td><td colspan="1" class="confluenceTd">Database</td></tr><tr><td colspan="1" class="confluenceTd">type</td><td colspan="1" class="confluenceTd">DatabaseImplementation</td></tr></tbody></table><p> </p><h3>Storage settings</h3><p>The settings for &quot;VarDir&quot; and &quot;StorageDir&quot; are set based on current settings in your yml files as shown below.</p><p><strong>Mapping:</strong></p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">yml</th><th class="confluenceTh">site.ini [FileSettings]</th></tr><tr><td class="confluenceTd">var_dir</td><td class="confluenceTd">VarDir</td></tr><tr><td class="confluenceTd">storage_dir</td><td class="confluenceTd">StorageDir</td></tr></tbody></table><p> </p><h3>Image settings</h3><p>Some of the settings for image sub system are set based on your yml files as shown below.</p><p><strong>Mapping:</strong></p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">yml</th><th class="confluenceTh">image.ini</th></tr><tr><td class="confluenceTd">ezpublish.image.temporary_dir</td><td class="confluenceTd">[FileSettings]\TemporaryDir</td></tr><tr><td class="confluenceTd">ezpublish.image.published_images_dir</td><td class="confluenceTd"><span>[FileSettings]\PublishedImages</span></td></tr><tr><td colspan="1" class="confluenceTd">ezpublish.image.versioned_images_dir</td><td colspan="1" class="confluenceTd"><span>[FileSettings]\VersionedImages</span></td></tr><tr><td colspan="1" class="confluenceTd">image_variations</td><td colspan="1" class="confluenceTd"><span>[FileSettings]\AliasList</span></td></tr><tr><td colspan="1" class="confluenceTd">ezpublish.image.imagemagick.enabled</td><td colspan="1" class="confluenceTd"><span>[ImageMagick]\IsEnabled</span></td></tr><tr><td colspan="1" class="confluenceTd">ezpublish.image.imagemagick.executable_path</td><td colspan="1" class="confluenceTd"><span>[ImageMagick]\ExecutablePath</span></td></tr><tr><td colspan="1" class="confluenceTd">ezpublish.image.imagemagick.executable</td><td colspan="1" class="confluenceTd"><span>[ImageMagick]\Executable</span></td></tr><tr><td colspan="1" class="confluenceTd">imagemagick.pre_parameters</td><td colspan="1" class="confluenceTd"><span>[</span><span>ImageMagick</span><span>]\PreParameters</span></td></tr><tr><td colspan="1" class="confluenceTd">imagemagick.post_parameters</td><td colspan="1" class="confluenceTd"><span>[</span><span>ImageMagick</span><span>]\PostParameters</span></td></tr><tr><td colspan="1" class="confluenceTd">ezpublish.image.imagemagick.filters</td><td colspan="1" class="confluenceTd"><span>[</span><span>ImageMagick</span><span>]\Filters</span></td></tr></tbody></table><table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Image aliases : image_variations" style="background-image: url(../servlet/confluence/placeholder/macro-heading748d.png?definition=e25vdGU6dGl0bGU9SW1hZ2UgYWxpYXNlcyA6IGltYWdlX3ZhcmlhdGlvbnN9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Note : for image_variations the <em>small</em> value is referenced in ezoe configuration and this configuration needs to be changed if the small variation is removed.</p></td></tr></table><p> </p><h3>Using ImageMagick filters</h3><p>The following block shows a valid ImageMagick filter usage example for <code>ezpublish.yml</code>:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ImageMagick filters usage example" style="background-image: url(../servlet/confluence/placeholder/macro-headingda45.png?definition=e2NvZGU6dGl0bGU9SW1hZ2VNYWdpY2sgZmlsdGVycyB1c2FnZSBleGFtcGxlfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    imagemagick:
        filters:
            geometry/scale: "-geometry {1}x{2}"</pre></td></tr></table><p>Since ImageMagick filter usage changed from eZ Publish 4.x versions you can find the list of filters existing by default to use eZ Publish 5.x:</p><table class="confluenceTable"><tbody><tr><th class="confluenceTh">ImageMagick filters list for yml</th></tr><tr><td class="confluenceTd"><code>sharpen: &quot;-sharpen 0.5&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scale: &quot;-geometry {1}x{2}&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scalewidth: &quot;-geometry {1}&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scaleheight: &quot;-geometry x{1}&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scaledownonly: &quot;-geometry {1}x{2}&gt;&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scalewidthdownonly: &quot;-geometry {1}&gt;&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scaleheightdownonly: &quot;-geometry x{1}&gt;&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scaleexact: &quot;-geometry {1}x{2}!&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/scalepercent: &quot;-geometry {1}x{2}&quot;</code></td></tr><tr><td class="confluenceTd"><code>geometry/crop: &quot;-crop {1}x{2}+{3}+{4}&quot;</code></td></tr><tr><td class="confluenceTd"><code>filter/noise: &quot;-noise {1}&quot;</code></td></tr><tr><td class="confluenceTd"><code>filter/swirl: &quot;-swirl {1}&quot;</code></td></tr><tr><td class="confluenceTd"><code>colorspace/gray: &quot;-colorspace GRAY&quot;</code></td></tr><tr><td class="confluenceTd"><code>colorspace/transparent: &quot;-colorspace Transparent&quot;</code></td></tr><tr><td class="confluenceTd"><code>colorspace: &quot;-colorspace {1}&quot;</code></td></tr><tr><td class="confluenceTd"><code>border: &quot;-border {1}x{2}&quot;</code></td></tr><tr><td class="confluenceTd"><code>border/color: &quot;-bordercolor rgb({1},{2},{3})&quot;</code></td></tr><tr><td class="confluenceTd"><code>border/width: &quot;-borderwidth {1}&quot;</code></td></tr><tr><td colspan="1" class="confluenceTd"><code>flatten: &quot;-flatten&quot;</code></td></tr><tr><td colspan="1" class="confluenceTd"><p><code>resize: &quot;-resize {1}&quot;</code></p></td></tr></tbody></table><p>For more details on setting ImageMagick filters on image.ini please refer to the <a href="../../eZ-Publish/Technical-manual/4.x/Reference/Configuration-files/image.ini/ImageMagick/Filters.html">[imagemagick] / filters</a> documentation.</p><h3>Extending injected settings</h3><p>It's possible to add your own kernel event subscriber and also inject your own settings by following how it is done in LegacyMapper\Configuration, and then at the end merge it with existing injected settings, like so:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=injected-settings" style="background-image: url(../servlet/confluence/placeholder/macro-heading4c48.png?definition=e2NvZGU6dGl0bGU9aW5qZWN0ZWQtc2V0dGluZ3N8bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>        $event->getParameters()->set(
            "injected-settings",
            $settings + (array)$event->getParameters()->get( "injected-settings" )
        );</pre></td></tr></table><h2>Injected Behavior</h2><p>In addition to injected settings, some injection of behavior is also performed.</p><h3>eZFormToken (CSRF) integration</h3><table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>This feature is only available as of eZ Publish 5.1 (2013.01)</p></td></tr></table><p>If your config.yml setting have <em>framework.csrf_protection.enabled</em> set to <em>true</em>, then both <em>kernel.secret</em> and <em>framework.csrf_protection.field_name</em> will be sent to ezxFormToken class so csrf protection in legacy uses the same token and form field name.</p><p>By making sure all your Symfony forms uses the provided <a href="http://symfony.com/doc/current/book/forms.html#forms-csrf">csrf</a> <a href="http://symfony.com/doc/current/reference/forms/types/csrf.html">protection</a>, forms with <em>intention=legacy</em> can be set up to send data to legacy kernel:</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php" style="background-image: url(../servlet/confluence/placeholder/macro-heading1802.png?definition=e2NvZGU6bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>$formOptions = array( 'intention' => 'legacy' );
$form = $this->createFormBuilder( null, $formOptions )
    ->...
    ->getForm();</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="warning" style="background-image: url(../servlet/confluence/placeholder/macro-headingca13.png?definition=e3dhcm5pbmd9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p><code>framework.csrf_protection.field_name</code> shouldn't be changed as that would prevent eZFormToken from working with most AJAX custom code</p></td></tr></table><h3>ezpEvent (Cache clear) integration</h3><p>A listener is set up for both content/cache and content/cache/all to make sure Symfony (Internal proxy or Varnish with custom vcl) HTTP cache is cleared when cache is cleared in eZ Publish admin interface. </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=8323268 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 09:41:30 GMT -->
</html>
