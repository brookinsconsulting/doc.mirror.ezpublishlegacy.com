                    
    
                    
    
                    
    
<!DOCTYPE html>
<html>
    
<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=13468497 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 09:45:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
        <title>View Source</title>
        <link rel="canonical" href="../../pages/viewpage2392.html?pageId=13468497" />
        <link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch934e.css?media=print" media="print">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+8" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/73/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1f2a9c4c7f2593422cc9b02d1a652a22/_/download/contextbatch/css/plugin.viewsource/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/70f6d025b64de5008ccd042576cd8d90/_/download/contextbatch/css/page/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/26ac2724af3c6ece1051365650d982fa/_/download/contextbatch/css/editor-content/batch.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-hig/com.atlassian.confluence.plugins.confluence-highlight-ac" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/s/d41d8cd98f00b204e9800998ecf8427e/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/1.3/_/download/batch/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources/com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/51/_/styles/colorsb538.css?spaceKey=EZP" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB-1988229788/4733/f235dd088df5682b0560ab6fc66ed22c9124c0be.12/51/_/styles/customb538.css?spaceKey=EZP" media="all">

    </head>

    <body class="mceContentBody aui-theme-default wiki-content fullsize">
        <p>&nbsp;</p>         <table class="wysiwyg-macro" data-macro-name="note" data-macro-parameters="title=Version compatibility" style="background-image: url(../servlet/confluence/placeholder/macro-heading77d5.png?definition=e25vdGU6dGl0bGU9VmVyc2lvbiBjb21wYXRpYmlsaXR5fQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>This recipe is compatible with <strong>eZ Publish 5.2 / 2013.07</strong></p></td></tr></table><p><img class="editor-inline-macro" src="../servlet/confluence/placeholder/macro4170.png?definition=e3RvY30&amp;locale=en_GB&amp;version=2" data-macro-name="toc"></p><h1>Enhanced views for Content/Location</h1><p>In some cases, displaying a content/location via the built-in <code>ViewController</code> is not sufficient and will lead you to do many sub-requests in order to access different parameters.</p><p>Typical use cases are access to:</p><ul><li>Settings (either coming from <code>ConfigResolver</code> or <code>ServiceContainer</code>)</li><li>Current content's <code>ContentType</code> object</li><li>Current location's parent</li><li>Current location's children count</li><li>Main location and alternative locations for the current content</li><li>etc…</li></ul><p>In those cases, you may want to <strong>use your own controller</strong> to display the current content/location instead of using the built-in <code>ViewController</code>.</p><h2>Description</h2><p>This feature covers 2 general use cases:</p><ul><li>Lets you configure a custom controller with the configured matcher rules.</li><li>Lets you override the built-in view controller in a clean way.</li></ul><h2>Matching custom controllers</h2><p>This is possible with the following piece of configuration:</p><table class="wysiwyg-macro" data-macro-name="code" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    system:
        my_siteaccess:
            location_view:
                full:
                    # Defining a ruleset matching a location and pointing to a controller
                    my_ruleset:
                        # The following will let you use your own custom controller for location #123
                        # (Here it will use AcmeTestBundle/Controller/DefaultController::viewLocationAction(),
                        # following the Symfony controller notation convention.
                        # Method viewLocationAction() must follow the same prototype as in the built-in ViewController
                        controller: AcmeTestBundle:Default:viewLocation
                        match:
                            Id\Location: 123</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" style="background-image: url(../servlet/confluence/placeholder/macro-headingd35c.png?definition=e2luZm99&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>You can point to any kind of <a href="http://symfony.com/doc/current/book/page_creation.html#step-2-create-the-controller">controller supported by Symfony</a> (including <a href="http://symfony.com/doc/current/cookbook/controller/service.html">controllers as a service</a>).</p></td></tr></table><p><span style="font-size: 10.0pt;line-height: 13.0pt;">The only requirement here is that your action method has a similar signature than </span><code style="font-size: 10.0pt;line-height: 13.0pt;">ViewController::viewLocation()</code><span style="font-size: 10.0pt;line-height: 13.0pt;"> or </span><code style="font-size: 10.0pt;line-height: 13.0pt;">ViewController::viewContent()</code><span style="font-size: 10.0pt;line-height: 13.0pt;"> (depending on what you're matching of course). However, note that all arguments are not mandatory since </span><a href="http://symfony.com/doc/current/book/routing.html#route-parameters-and-controller-arguments" style="font-size: 10.0pt;line-height: 13.0pt;">Symfony is clever enough to know what to inject in your action method</a><span style="font-size: 10.0pt;line-height: 13.0pt;">. Hence <strong>you're not forced to mimic the <code>ViewController</code>'s signature strictly</strong>. For example, if you omit <code>$layout</code> and <code>$params</code> arguments, it will be still valid. Symfony will just avoid to inject them in your action method.</span></p><h3>Original ViewController signatures</h3><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=viewLocation() signature" style="background-image: url(../servlet/confluence/placeholder/macro-heading311f.png?definition=e2NvZGU6dGl0bGU9dmlld0xvY2F0aW9uKCkgc2lnbmF0dXJlfGxhbmd1YWdlPXBocH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>/**
 * Main action for viewing content through a location in the repository.
 *
 * @param int $locationId
 * @param string $viewType
 * @param boolean $layout
 * @param array $params
 *
 * @throws \Symfony\Component\Security\Core\Exception\AccessDeniedException
 * @throws \Exception
 *
 * @return \Symfony\Component\HttpFoundation\Response
 */
public function viewLocation( $locationId, $viewType, $layout = false, array $params = array() )</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=viewContent() signature" style="background-image: url(../servlet/confluence/placeholder/macro-headingc658.png?definition=e2NvZGU6dGl0bGU9dmlld0NvbnRlbnQoKSBzaWduYXR1cmV8bGFuZ3VhZ2U9cGhwfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>/**
 * Main action for viewing content.
 *
 * @param int $contentId
 * @param string $viewType
 * @param boolean $layout
 * @param array $params
 *
 * @throws \Symfony\Component\Security\Core\Exception\AccessDeniedException
 * @throws \Exception
 *
 * @return \Symfony\Component\HttpFoundation\Response
 */
public function viewContent( $contentId, $viewType, $layout = false, array $params = array() )</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=Note" style="background-image: url(../servlet/confluence/placeholder/macro-headingb7a0.png?definition=e2luZm86dGl0bGU9Tm90ZX0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Controller selection doesn't apply to <code>block_view</code> since you can already <a class="confluence-link" href="../../display/EZP/The%2bPage%2bFieldType.html#ThePageFieldType-ThePageFieldType-Renderingblocks" data-anchor="ThePageFieldType-Renderingblocks" data-linked-resource-id="12124915" data-linked-resource-type="page" data-linked-resource-default-alias="The Page FieldType#ThePageFieldType-Renderingblocks" data-base-url="../../index.html">use your own controller to display blocks</a>.</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="warning" data-macro-parameters="title=Warning on caching" style="background-image: url(../servlet/confluence/placeholder/macro-heading03bf.png?definition=e3dhcm5pbmc6dGl0bGU9V2FybmluZyBvbiBjYWNoaW5nfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Using your own controller, <u><strong>it is your responsibility to define cache rules</strong></u>, like for every custom controller !</p><p>So don't forget to <strong>set cache rules</strong> and the appropriate <strong><code>X-Location-Id</code> header</strong> in the returned <code>Response</code> object.</p><p><a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/MVC/Symfony/Controller/Content/ViewController.php#L76">See built-in ViewController</a> for more details on this.</p></td></tr></table><h2>Examples</h2><h3>Enriching built-in ViewController</h3><p>This example shows how to use a custom controller to enrich the final configured view template. Your controller will here forward the request to the built-in <code>ViewController</code> with some additional parameters.</p><table class="wysiwyg-macro" data-macro-name="tip" style="background-image: url(../servlet/confluence/placeholder/macro-heading7f8c.png?definition=e3RpcH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><strong>This is usually the recommended way to use a custom controller.</strong></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ezpublish.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    system:
        ezdemo_frontend_group:
            location_view:
                full:
                    article_test:
                        # Configuring both controller and template as the controller will forward
                        # the request to the ViewController which will render the configured template.
                        controller: AcmeTestBundle:Default:articleViewEnhanced
                        template: AcmeTestBundle:full:article_test.html.twig
                        match:
                            Identifier\ContentType: [article]</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Controller" style="background-image: url(../servlet/confluence/placeholder/macro-headingb46a.png?definition=e2NvZGU6dGl0bGU9Q29udHJvbGxlcnxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php
namespace Acme\TestBundle\Controller;
use Symfony\Component\HttpFoundation\Response;
use eZ\Bundle\EzPublishCoreBundle\Controller;

class DefaultController extends Controller
{
    public function articleViewEnhancedAction( $locationId, $viewType, $layout = false, array $params = array() )
    {
        $params += array( 'myCustomVariable' => "Hey, I'm a custom message!" );
        // Forward the request to the original ViewController
        // And get the response. Eventually alter it (here we change the smax-age for cache).
        $response = $this->get( 'ez_content' )->viewLocation( $locationId, $viewType, $layout, $params );
        $response->setSharedMaxAge( 600 );

        return $response;
    }
}</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=article_test.html.twig" style="background-image: url(../servlet/confluence/placeholder/macro-heading3cf9.png?definition=e2NvZGU6dGl0bGU9YXJ0aWNsZV90ZXN0Lmh0bWwudHdpZ30&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{% extends noLayout ? viewbaseLayout : "eZDemoBundle::pagelayout.html.twig" %}

{% block content %}
    &lt;h1>{{ ez_render_field( content, 'title' ) }}&lt;/h1>
    &lt;h2>{{ myCustomVariable }}&lt;/h2>
    {{ ez_render_field( content, 'body' ) }}
{% endblock %}</pre></td></tr></table><h3>Using a custom controller to get full control</h3><p>This example shows you how to configure and use your own controller to handle a location.</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=ezpublish.yml" style="background-image: url(../servlet/confluence/placeholder/macro-heading8bc7.png?definition=e2NvZGU6dGl0bGU9ZXpwdWJsaXNoLnltbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>ezpublish:
    system:
        ezdemo_frontend_group:
            location_view:
                full:
                    my_ruleset:
                        controller: AcmeTestBundle:Default:viewFolder
                        match:
                            Identifier\ContentType: [folder]
                            Identifier\Section: [standard]</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=php|title=Controller" style="background-image: url(../servlet/confluence/placeholder/macro-headingb46a.png?definition=e2NvZGU6dGl0bGU9Q29udHJvbGxlcnxsYW5ndWFnZT1waHB9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>&lt;?php
namespace Acme\TestBundle\Controller;
use Symfony\Component\HttpFoundation\Response;
use eZ\Bundle\EzPublishCoreBundle\Controller;

class DefaultController extends Controller
{
    public function viewFolderAction( $locationId, $layout = false )
    {
        $repository = $this->getRepository();
        $location = $repository->getLocationService()->loadLocation( $locationId );
        $response = new Response();
        $response->headers->set( 'X-Location-Id', $locationId );
        // Caching for 1h and make the cache vary on user hash
        $response->setSharedMaxAge( 3600 );
        $response->setVary( 'X-User-Hash' );
        return $this->render(
            'AcmeTestBundle::custom_controller_folder.html.twig',
            array(
                'location' => $location,
                'content' => $repository->getContentService()->loadContentByContentInfo( $location->getContentInfo() ),
                'foo' => 'Hey world!!!',
                'osTypes' => array( 'osx', 'linux', 'losedows' )
            )
        );
    }
}

</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="title=custom_controller_folder.html.twig" style="background-image: url(../servlet/confluence/placeholder/macro-heading5b8b.png?definition=e2NvZGU6dGl0bGU9Y3VzdG9tX2NvbnRyb2xsZXJfZm9sZGVyLmh0bWwudHdpZ30&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{% extends "eZDemoBundle::pagelayout.html.twig" %}

{% block content %}
&lt;h1>{{ ez_render_field( content, 'title' ) }}&lt;/h1>
    &lt;h1>{{ foo }}&lt;/h1>
    &lt;ul>
    {% for os in osTypes %}
        &lt;li>{{ os }}&lt;/li>
    {% endfor %}
    &lt;/ul>
{% endblock %}
</pre></td></tr></table><h2>Overriding the built-in ViewController</h2><p>One other way to keep control on what is passed to the view is to use your own controller instead of the built-in ViewController.</p><p>Base ViewController being defined as a service, with a service alias, this can be easily achieved from your bundle's configuration:</p><table class="wysiwyg-macro" data-macro-name="code" style="background-image: url(../servlet/confluence/placeholder/macro-heading34e7.png?definition=e2NvZGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>parameters:
    my.custom.view_controller.class: Acme\TestBundle\MyViewController

services:
    my.custom.view_controller:
        class: %my.custom.view_controller.class%
        arguments: [@some_dependency, @other_dependency]

    # Change the alias here and make it point to your own controller
    ez_content:
        alias: my.custom.view_controller</pre></td></tr></table><table class="wysiwyg-macro" data-macro-name="warning" data-macro-parameters="title=Warning" style="background-image: url(../servlet/confluence/placeholder/macro-heading340d.png?definition=e3dhcm5pbmc6dGl0bGU9V2FybmluZ30&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>Doing so will completely override the built-in ViewController! Use this at your own risk!</p></td></tr></table><table class="wysiwyg-macro" data-macro-name="info" data-macro-parameters="title=See also" style="background-image: url(../servlet/confluence/placeholder/macro-headingdd57-2.png?definition=e2luZm86dGl0bGU9U2VlIGFsc299&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT"><tr><td class="wysiwyg-macro-body"><p>See also</p><p><a href="https://confluence.ez.no/display/EZP/Content+view#Contentview-Displayadefaulttext">How to Display a default text while asynchronous loading of a controller</a></p><p><a href="../../display/EZP/Content%2bview.html#Contentview-Renderembeddedcontentobjects">How to render an embedded content from a Twig template</a></p></td></tr></table><p> </p><p> </p>
        <p>&nbsp;</p>
    </body>

<!-- Mirrored from doc.ez.no/plugins/viewsource/viewpagesrc.action?pageId=13468497 by HTTrack Website Copier/3.x [XR&CO'2013], Tue, 21 Oct 2014 09:45:51 GMT -->
</html>
